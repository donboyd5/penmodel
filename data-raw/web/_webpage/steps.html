<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Steps involved in streamlining the pension model for Florida FRS – penmodel</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./steps.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Steps involved in streamlining the pension model for Florida FRS</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">penmodel</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./steps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Steps involved in streamlining the pension model for Florida FRS</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">2.1</span> Setup</a></li>
  <li><a href="#load-reason-frs-workspace" id="toc-load-reason-frs-workspace" class="nav-link" data-scroll-target="#load-reason-frs-workspace"><span class="header-section-number">2.2</span> Load Reason FRS workspace</a></li>
  <li><a href="#copy-workforce-data-from-reason-frs-environment-to-global-environment-as-stacked-data-frames" id="toc-copy-workforce-data-from-reason-frs-environment-to-global-environment-as-stacked-data-frames" class="nav-link" data-scroll-target="#copy-workforce-data-from-reason-frs-environment-to-global-environment-as-stacked-data-frames"><span class="header-section-number">2.3</span> Copy workforce data from Reason FRS environment to global environment as stacked data frames</a></li>
  <li><a href="#reproduce-baseline_funding---get_funding_data-with-more-generalizable-code" id="toc-reproduce-baseline_funding---get_funding_data-with-more-generalizable-code" class="nav-link" data-scroll-target="#reproduce-baseline_funding---get_funding_data-with-more-generalizable-code"><span class="header-section-number">2.4</span> Reproduce <code>baseline_funding &lt;- get_funding_data()</code> with more generalizable code</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2.4.1</span> Introduction</a></li>
  <li><a href="#outputs-from-get_funding_data" id="toc-outputs-from-get_funding_data" class="nav-link" data-scroll-target="#outputs-from-get_funding_data"><span class="header-section-number">2.4.2</span> Outputs from <code>get_funding_data()</code></a></li>
  <li><a href="#inputs-to-get_funding_data" id="toc-inputs-to-get_funding_data" class="nav-link" data-scroll-target="#inputs-to-get_funding_data"><span class="header-section-number">2.4.3</span> Inputs to get_funding_data()</a></li>
  <li><a href="#reproducing-results" id="toc-reproducing-results" class="nav-link" data-scroll-target="#reproducing-results"><span class="header-section-number">2.4.4</span> Reproducing results</a></li>
  </ul></li>
  <li><a href="#reproduce-baseline_liability---get_liability_data-with-more-generalizable-code" id="toc-reproduce-baseline_liability---get_liability_data-with-more-generalizable-code" class="nav-link" data-scroll-target="#reproduce-baseline_liability---get_liability_data-with-more-generalizable-code"><span class="header-section-number">2.5</span> Reproduce <code>baseline_liability &lt;- get_liability_data()</code> with more generalizable code</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1"><span class="header-section-number">2.5.1</span> Introduction</a></li>
  <li><a href="#outputs-from-get_liability_data" id="toc-outputs-from-get_liability_data" class="nav-link" data-scroll-target="#outputs-from-get_liability_data"><span class="header-section-number">2.5.2</span> Outputs from <code>get_liability_data()</code></a></li>
  <li><a href="#inputs-to-get_liability_data" id="toc-inputs-to-get_liability_data" class="nav-link" data-scroll-target="#inputs-to-get_liability_data"><span class="header-section-number">2.5.3</span> Inputs to get_liability_data()</a></li>
  <li><a href="#reproducing-results-1" id="toc-reproducing-results-1" class="nav-link" data-scroll-target="#reproducing-results-1"><span class="header-section-number">2.5.4</span> Reproducing results</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Steps involved in streamlining the pension model for Florida FRS</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="setup" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">2.1</span> Setup</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># source(here::here("report", "_common.R"))</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>draw <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data-raw"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#. directories -- Florida FRS data - from the FRS2 project, but saved in the pendata project ----</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>dfrs <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">path</span>(r<span class="st">"(E:/R_projects/packages/pendata/data-raw/frs)"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>drds <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">path</span>(dfrs, <span class="st">"rds"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>dfreason <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">path</span>(dfrs, <span class="st">"from_reason"</span>) <span class="co"># dfreason = directory -- from reason</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#. libraries ----</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># source(here::here("data-raw", "libraries.r"))</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(fs<span class="sc">::</span><span class="fu">path</span>(draw, <span class="st">"libraries.r"</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># . constants ----</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>frs_constants <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fs<span class="sc">::</span><span class="fu">path</span>(drds, <span class="st">"frs_constants.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>get_object <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">envir =</span> rws){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get an object from the rws environment</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x is character string</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># it is NOT saved in the global environment - assign if desired</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get</span>(x, <span class="at">envir =</span> rws)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># get_object("year_range_")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-reason-frs-workspace" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="load-reason-frs-workspace"><span class="header-section-number">2.2</span> Load Reason FRS workspace</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load Reason FRS workspace into its OWN environment I call rws ------------------------------</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   workspace was saved on 4/24/2024:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#      in my variant of Reason FRS project -- E:/R_projects/projects/Florida-FRS-main_v2/boyd_save_to_pendata.R</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#      to dfreason folder in pendata: save.image(fs::path(dfreason, "reason_workspace.RData"))</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># load takes some time</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>wspath <span class="ot">&lt;-</span> <span class="fu">path</span>(dfreason, <span class="st">"reason_workspace.RData"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(wspath, rws <span class="ot">&lt;-</span> <span class="fu">new.env</span>())</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>objnames <span class="ot">&lt;-</span> <span class="fu">ls</span>(<span class="at">name=</span>rws) <span class="co"># names of objects in the workspace</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>objnames <span class="co"># almost 300 objects!; already sorted by name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "add_new_entrants"                                 
  [2] "admin_ben_payment_current_"                       
  [3] "admin_early_retire_rate_tier_1_table"             
  [4] "admin_early_retire_rate_tier_2_table"             
  [5] "admin_entrant_profile_table"                      
  [6] "admin_er_dc_cont_rate_"                           
  [7] "admin_expense_"                                   
  [8] "admin_headcount_table_"                           
  [9] "admin_mort_retire_table"                          
 [10] "admin_mort_table"                                 
 [11] "admin_nc_cal_"                                    
 [12] "admin_normal_retire_rate_tier_1_table"            
 [13] "admin_normal_retire_rate_tier_2_table"            
 [14] "admin_outflow_"                                   
 [15] "admin_pvfb_term_current_"                         
 [16] "admin_retiree_pop_current_"                       
 [17] "admin_salary_headcount_table"                     
 [18] "admin_salary_table_"                              
 [19] "admin_separation_rate_table"                      
 [20] "admin_term_rate_female_table_"                    
 [21] "admin_term_rate_male_table_"                      
 [22] "admin_total_active_member_"                       
 [23] "admin_val_norm_cost_"                             
 [24] "admin_wf_data"                                    
 [25] "age_range_"                                       
 [26] "amo_method_"                                      
 [27] "amo_pay_growth_"                                  
 [28] "amo_period_new_"                                  
 [29] "amo_period_term_"                                 
 [30] "amo_term_growth_"                                 
 [31] "annfactor"                                        
 [32] "base_general_mort_table"                          
 [33] "base_general_mort_table_"                         
 [34] "base_regular_mort_table"                          
 [35] "base_safety_mort_table"                           
 [36] "base_safety_mort_table_"                          
 [37] "base_teacher_mort_table"                          
 [38] "base_teacher_mort_table_"                         
 [39] "baseR.rollmean"                                   
 [40] "ben_payment_ratio_"                               
 [41] "cal_factor_"                                      
 [42] "class_name_"                                      
 [43] "class_names"                                      
 [44] "class_names_no_drop_frs"                          
 [45] "class_names_no_frs"                               
 [46] "clean_mp_table"                                   
 [47] "clean_retire_rate_table"                          
 [48] "cola_current_retire_"                             
 [49] "cola_current_retire_one_"                         
 [50] "cola_tier_1_active_"                              
 [51] "cola_tier_1_active_constant_"                     
 [52] "cola_tier_2_active_"                              
 [53] "cola_tier_3_active_"                              
 [54] "contribution_refunds_"                            
 [55] "cumFV2"                                           
 [56] "current_amort_layers_table"                       
 [57] "current_amort_layers_table_"                      
 [58] "db_ee_cont_rate_"                                 
 [59] "db_ee_interest_rate_"                             
 [60] "dfreason"                                         
 [61] "disbursement_to_ip_"                              
 [62] "dr_current_"                                      
 [63] "dr_new_"                                          
 [64] "dr_old_"                                          
 [65] "drop_entry_table_col_names"                       
 [66] "drop_entry_tier_1_table"                          
 [67] "drop_entry_tier_1_table_"                         
 [68] "drop_entry_tier_2_table"                          
 [69] "drop_entry_tier_2_table_"                         
 [70] "early_retire_rate_tier_1_table"                   
 [71] "early_retire_rate_tier_2_table"                   
 [72] "early_retire_table_col_names"                     
 [73] "early_retirement_tier_1_table_"                   
 [74] "early_retirement_tier_2_table_"                   
 [75] "eco_ben_payment_current_"                         
 [76] "eco_early_retire_rate_tier_1_table"               
 [77] "eco_early_retire_rate_tier_2_table"               
 [78] "eco_entrant_profile_table"                        
 [79] "eco_er_dc_cont_rate_"                             
 [80] "eco_eso_judges_active_member_adjustment_ratio"    
 [81] "eco_eso_judges_total_active_member_"              
 [82] "eco_headcount_table_"                             
 [83] "eco_mort_retire_table"                            
 [84] "eco_mort_table"                                   
 [85] "eco_nc_cal_"                                      
 [86] "eco_normal_retire_rate_tier_1_table"              
 [87] "eco_normal_retire_rate_tier_2_table"              
 [88] "eco_outflow_"                                     
 [89] "eco_pvfb_term_current_"                           
 [90] "eco_retiree_pop_current_"                         
 [91] "eco_salary_headcount_table"                       
 [92] "eco_salary_table_"                                
 [93] "eco_separation_rate_table"                        
 [94] "eco_term_rate_female_table_"                      
 [95] "eco_term_rate_male_table_"                        
 [96] "eco_val_norm_cost_"                               
 [97] "eco_wf_data"                                      
 [98] "entry_year_range_"                                
 [99] "eso_ben_payment_current_"                         
[100] "eso_early_retire_rate_tier_1_table"               
[101] "eso_early_retire_rate_tier_2_table"               
[102] "eso_entrant_profile_table"                        
[103] "eso_er_dc_cont_rate_"                             
[104] "eso_headcount_table_"                             
[105] "eso_mort_retire_table"                            
[106] "eso_mort_table"                                   
[107] "eso_nc_cal_"                                      
[108] "eso_normal_retire_rate_tier_1_table"              
[109] "eso_normal_retire_rate_tier_2_table"              
[110] "eso_outflow_"                                     
[111] "eso_pvfb_term_current_"                           
[112] "eso_retiree_pop_current_"                         
[113] "eso_salary_headcount_table"                       
[114] "eso_salary_table_"                                
[115] "eso_separation_rate_table"                        
[116] "eso_term_rate_female_table_"                      
[117] "eso_term_rate_male_table_"                        
[118] "eso_val_norm_cost_"                               
[119] "eso_wf_data"                                      
[120] "est_arith_return"                                 
[121] "est_geo_return"                                   
[122] "expected_icr"                                     
[123] "female_mp_final_table"                            
[124] "female_mp_table"                                  
[125] "female_mp_table_"                                 
[126] "FileName"                                         
[127] "funding_lag_"                                     
[128] "funding_list"                                     
[129] "funding_policy_"                                  
[130] "geo_return"                                       
[131] "get_base_mort_table"                              
[132] "get_benefit_data"                                 
[133] "get_cum_fv"                                       
[134] "get_early_retire_rate_table"                      
[135] "get_funding_data"                                 
[136] "get_funding_table"                                
[137] "get_liability_data"                               
[138] "get_mort_retire_table"                            
[139] "get_mort_table"                                   
[140] "get_mp_final_table"                               
[141] "get_normal_retire_rate_table"                     
[142] "get_pmt"                                          
[143] "get_pmt0"                                         
[144] "get_pvfb"                                         
[145] "get_pvfs"                                         
[146] "get_salary_headcount_table"                       
[147] "get_sep_type"                                     
[148] "get_separation_table"                             
[149] "get_tier"                                         
[150] "get_wf_data"                                      
[151] "inflation_"                                       
[152] "init_funding_data"                                
[153] "judges_ben_payment_current_"                      
[154] "judges_early_retire_rate_tier_1_table"            
[155] "judges_early_retire_rate_tier_2_table"            
[156] "judges_entrant_profile_table"                     
[157] "judges_er_dc_cont_rate_"                          
[158] "judges_headcount_table_"                          
[159] "judges_mort_retire_table"                         
[160] "judges_mort_table"                                
[161] "judges_nc_cal_"                                   
[162] "judges_normal_retire_rate_tier_1_table"           
[163] "judges_normal_retire_rate_tier_2_table"           
[164] "judges_outflow_"                                  
[165] "judges_pvfb_term_current_"                        
[166] "judges_retiree_pop_current_"                      
[167] "judges_salary_headcount_table"                    
[168] "judges_salary_table_"                             
[169] "judges_separation_rate_table"                     
[170] "judges_term_rate_female_table_"                   
[171] "judges_term_rate_male_table_"                     
[172] "judges_val_norm_cost_"                            
[173] "judges_wf_data"                                   
[174] "male_mp_final_table"                              
[175] "male_mp_table"                                    
[176] "male_mp_table_"                                   
[177] "max_age_"                                         
[178] "max_year_"                                        
[179] "min_age_"                                         
[180] "min_year_"                                        
[181] "model_period_"                                    
[182] "model_return_"                                    
[183] "new_year_"                                        
[184] "non_special_db_legacy_after_2018_ratio_"          
[185] "non_special_db_legacy_before_2018_ratio_"         
[186] "non_special_db_new_ratio_"                        
[187] "normal_retire_rate_tier_1_table"                  
[188] "normal_retire_rate_tier_2_table"                  
[189] "normal_retire_table_col_names"                    
[190] "normal_retirement_tier_1_table_"                  
[191] "normal_retirement_tier_2_table_"                  
[192] "NPER"                                             
[193] "npv"                                              
[194] "one_time_cola_"                                   
[195] "payroll_growth_"                                  
[196] "pension_payment_"                                 
[197] "pop_growth_"                                      
[198] "pv"                                               
[199] "PVFB_CB"                                          
[200] "recur_grow"                                       
[201] "recur_grow2"                                      
[202] "recur_grow3"                                      
[203] "regular_ben_payment_current_"                     
[204] "regular_early_retire_rate_tier_1_table"           
[205] "regular_early_retire_rate_tier_2_table"           
[206] "regular_entrant_profile_table"                    
[207] "regular_er_dc_cont_rate_"                         
[208] "regular_headcount_table_"                         
[209] "regular_mort_retire_table"                        
[210] "regular_mort_table"                               
[211] "regular_nc_cal_"                                  
[212] "regular_normal_retire_rate_tier_1_table"          
[213] "regular_normal_retire_rate_tier_2_table"          
[214] "regular_outflow_"                                 
[215] "regular_pvfb_term_current_"                       
[216] "regular_retiree_pop_current_"                     
[217] "regular_salary_headcount_table"                   
[218] "regular_salary_table_"                            
[219] "regular_separation_rate_table"                    
[220] "regular_term_rate_female_table_"                  
[221] "regular_term_rate_male_table_"                    
[222] "regular_total_active_member_"                     
[223] "regular_val_norm_cost_"                           
[224] "regular_wf_data"                                  
[225] "retire_refund_ratio_"                             
[226] "retiree_distribution"                             
[227] "return_2023_"                                     
[228] "return_scen_"                                     
[229] "return_scenarios"                                 
[230] "roll_npv"                                         
[231] "roll_pv"                                          
[232] "root_geo_return"                                  
[233] "salary_growth_table"                              
[234] "salary_growth_table_"                             
[235] "senior_management_ben_payment_current_"           
[236] "senior_management_early_retire_rate_tier_1_table" 
[237] "senior_management_early_retire_rate_tier_2_table" 
[238] "senior_management_entrant_profile_table"          
[239] "senior_management_er_dc_cont_rate_"               
[240] "senior_management_headcount_table_"               
[241] "senior_management_mort_retire_table"              
[242] "senior_management_mort_table"                     
[243] "senior_management_nc_cal_"                        
[244] "senior_management_normal_retire_rate_tier_1_table"
[245] "senior_management_normal_retire_rate_tier_2_table"
[246] "senior_management_outflow_"                       
[247] "senior_management_pvfb_term_current_"             
[248] "senior_management_retiree_pop_current_"           
[249] "senior_management_salary_headcount_table"         
[250] "senior_management_salary_table_"                  
[251] "senior_management_separation_rate_table"          
[252] "senior_management_term_rate_female_table_"        
[253] "senior_management_term_rate_male_table_"          
[254] "senior_management_total_active_member_"           
[255] "senior_management_val_norm_cost_"                 
[256] "senior_management_wf_data"                        
[257] "smooth_return"                                    
[258] "special_ben_payment_current_"                     
[259] "special_db_legacy_after_2018_ratio_"              
[260] "special_db_legacy_before_2018_ratio_"             
[261] "special_db_new_ratio_"                            
[262] "special_early_retire_rate_tier_1_table"           
[263] "special_early_retire_rate_tier_2_table"           
[264] "special_entrant_profile_table"                    
[265] "special_er_dc_cont_rate_"                         
[266] "special_headcount_table_"                         
[267] "special_mort_retire_table"                        
[268] "special_mort_table"                               
[269] "special_nc_cal_"                                  
[270] "special_normal_retire_rate_tier_1_table"          
[271] "special_normal_retire_rate_tier_2_table"          
[272] "special_outflow_"                                 
[273] "special_pvfb_term_current_"                       
[274] "special_retiree_pop_current_"                     
[275] "special_risk_drop_entry_tier_1_table"             
[276] "special_risk_drop_entry_tier_2_table"             
[277] "special_salary_headcount_table"                   
[278] "special_salary_table_"                            
[279] "special_separation_rate_table"                    
[280] "special_term_rate_female_table_"                  
[281] "special_term_rate_male_table_"                    
[282] "special_total_active_member_"                     
[283] "special_val_norm_cost_"                           
[284] "special_wf_data"                                  
[285] "start_year_"                                      
[286] "year_range_"                                      
[287] "yos_range_"                                       </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get(objnames[119], envir=rws) # how to get an object from the workspace</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="copy-workforce-data-from-reason-frs-environment-to-global-environment-as-stacked-data-frames" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="copy-workforce-data-from-reason-frs-environment-to-global-environment-as-stacked-data-frames"><span class="header-section-number">2.3</span> Copy workforce data from Reason FRS environment to global environment as stacked data frames</h2>
<p>For each of the 4 data frame types (active, term, refund, retire)</p>
<ul>
<li>create a stacked dataframe with all 7 classes</li>
<li>put the df into the global environment</li>
</ul>
<p>Reason, by contrast, stored the data as 7 data frames, one for each class.</p>
<p>The advantage of the 4 types as opposed to 7 classes is that they are generalizable to more pension systems. Most will need these demographics, whereas other systems won’t have the same number or types of classes as Florida.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's how reason gets the data in their FRS model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># regular_wf_data &lt;- readRDS("regular_wf_data.rds")</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># special_wf_data &lt;- readRDS("special_wf_data.rds")</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># admin_wf_data &lt;- readRDS("admin_wf_data.rds")</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># eco_wf_data &lt;- readRDS("eco_wf_data.rds")</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># eso_wf_data &lt;- readRDS("eso_wf_data.rds")</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># judges_wf_data &lt;- readRDS("judges_wf_data.rds")</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># senior_management_wf_data &lt;- readRDS("senior_management_wf_data.rds")</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># we'll get them all from the previously saved environment</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare class names and dataframe names ---------------------------------</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># oddly, Reason used seniormanagement as a class name</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  but used senior_management in dataframe names</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>wfclasses <span class="ot">&lt;-</span> frs_constants<span class="sc">$</span>classes <span class="sc">|&gt;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"seniormanagement"</span>, <span class="st">"senior_management"</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>wfnames <span class="ot">&lt;-</span> <span class="fu">paste0</span>(wfclasses, <span class="st">"_wf_data"</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>wfnames <span class="co"># names of wf objects to extract from Reason workspace</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(wfclasses, wfnames) <span class="co"># make sure they look right</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># unpack the data -------</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># get_object(wfnames[1])</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># get one big list of lists of data frames</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># outer list has 7 lists, one for each class</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># each inner list has 4 data frames</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   wf_active_df, term, refund, retire</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># they are similar but not the same in structure, but the same structure for each class</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>wflist <span class="ot">&lt;-</span> wfnames <span class="sc">|&gt;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x) <span class="fu">get_object</span>(x))<span class="sc">|&gt;</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">set_names</span>(wfclasses)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wflist)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>(wfdfnames <span class="ot">&lt;-</span> <span class="fu">names</span>(wflist[[<span class="dv">1</span>]]))</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># get 4 data frames, with classes stacked</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>nested <span class="ot">&lt;-</span> wflist <span class="sc">|&gt;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dfname=</span>wfdfnames) <span class="sc">|&gt;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>dfname, <span class="at">names_to =</span> <span class="st">"class"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> dfname)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co"># note that wf_retire_df is a dt data.table, others are df data.frame</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co"># if needed we can convert with:</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co"># nested |&gt;</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(wf_retire_df = map(wf_retire_df, as.data.frame))</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>unpack_dframes <span class="ot">&lt;-</span> <span class="cf">function</span>(colname){</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for a single data frame name (colname), stack all 7 classes into a single data frame</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and put the stacked data frame into the environment</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(colname)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> nested <span class="sc">|&gt;</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(class, <span class="at">nestcol=</span><span class="fu">all_of</span>(colname)) <span class="sc">|&gt;</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_wider</span>(<span class="at">col=</span>nestcol) <span class="sc">|&gt;</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_longer</span>(<span class="at">col=</span><span class="sc">-</span>class)</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(colname, df, <span class="at">envir =</span> .GlobalEnv)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk</span>(wfdfnames, unpack_dframes)  <span class="co"># unpack and stack all classes for each of the 4 data frames</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(wf_refund_df, class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  class                  n
  &lt;chr&gt;              &lt;int&gt;
1 admin             223200
2 eco               291648
3 eso               339264
4 judges            291648
5 regular           440448
6 senior_management 389360
7 special           440448</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(name <span class="cf">in</span> wfdfnames){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(name)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>(<span class="fu">get</span>(name))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "wf_active_df"
Rows: 151,001
Columns: 5
$ class     &lt;chr&gt; "regular", "regular", "regular", "regular", "regular", "regu…
$ entry_age &lt;dbl&gt; 18, 18, 18, 20, 18, 20, 18, 20, 18, 20, 18, 20, 18, 20, 25, …
$ age       &lt;int&gt; 18, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 24, 25, 25, 25, …
$ year      &lt;int&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, …
$ n_active  &lt;dbl&gt; 0.000, 0.000, 1086.047, 0.000, 0.000, 0.000, 0.000, 9997.682…
[1] "wf_term_df"
Rows: 2,416,016
Columns: 6
$ class     &lt;chr&gt; "regular", "regular", "regular", "regular", "regular", "regu…
$ entry_age &lt;dbl&gt; 18, 18, 18, 20, 18, 20, 18, 20, 18, 20, 18, 20, 18, 20, 25, …
$ age       &lt;int&gt; 18, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 24, 25, 25, 25, …
$ year      &lt;int&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, …
$ term_year &lt;int&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, …
$ n_term    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
[1] "wf_refund_df"
Rows: 2,416,016
Columns: 6
$ class     &lt;chr&gt; "regular", "regular", "regular", "regular", "regular", "regu…
$ entry_age &lt;dbl&gt; 18, 18, 18, 20, 18, 20, 18, 20, 18, 20, 18, 20, 18, 20, 25, …
$ age       &lt;int&gt; 18, 19, 20, 20, 21, 21, 22, 22, 23, 23, 24, 24, 25, 25, 25, …
$ year      &lt;int&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, …
$ term_year &lt;int&gt; 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, 2022, …
$ n_refund  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
[1] "wf_retire_df"
Rows: 144,525
Columns: 7
$ class       &lt;chr&gt; "regular", "regular", "regular", "regular", "regular", "re…
$ entry_age   &lt;dbl&gt; 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20…
$ age         &lt;int&gt; 53, 58, 63, 68, 54, 59, 64, 69, 55, 60, 65, 70, 56, 61, 66…
$ year        &lt;int&gt; 2023, 2023, 2023, 2023, 2024, 2024, 2024, 2024, 2025, 2025…
$ term_year   &lt;int&gt; 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023…
$ retire_year &lt;int&gt; 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023, 2023…
$ n_retire    &lt;dbl&gt; 357.44484, 360.97018, 105.46287, 31.89003, 356.39796, 359.…</code></pre>
</div>
</div>
<p>Here’s an example of code (not run) that can be used to get saved workforce data frames, put them in a list, and put them into the global environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>wf_dataframes <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fs<span class="sc">::</span><span class="fu">path</span>(dfreason, <span class="st">"wf_dataframes.rds"</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(wf_dataframes)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wf_dataframes) <span class="co"># wf_active_df,... term, refund, retire</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">list2env</span>(wf_dataframes, <span class="at">envir =</span> .GlobalEnv) <span class="co"># unlist them into the global environment</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(wf_dataframes) <span class="co"># remove the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reproduce-baseline_funding---get_funding_data-with-more-generalizable-code" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="reproduce-baseline_funding---get_funding_data-with-more-generalizable-code"><span class="header-section-number">2.4</span> Reproduce <code>baseline_funding &lt;- get_funding_data()</code> with more generalizable code</h2>
<section id="introduction" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2.4.1</span> Introduction</h3>
<p>In the FRS project, <code>get_funding_data()</code> is in <code>Florida FRS funding model.R, which</code> is sourced before running get_funding_data().</p>
<p>The R file has live code in addition to functions. Here is the live code – not run – but we have the information it creates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>class_names <span class="ot">&lt;-</span> init_funding_data<span class="sc">$</span>class</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>funding_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(class_names, get_funding_table)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(funding_list) <span class="ot">&lt;-</span> class_names</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>current_amort_layers_table <span class="ot">&lt;-</span> current_amort_layers_table_ <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">amo_period =</span> <span class="fu">if_else</span>(amo_period <span class="sc">==</span> <span class="st">"n/a"</span>, <span class="st">"20"</span>, amo_period),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">amo_period =</span> <span class="fu">as.numeric</span>(amo_period)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class, amo_period) <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">amo_balance =</span> <span class="fu">sum</span>(amo_balance)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#make sure that the amo periods are arranged in descending order</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(class, <span class="fu">desc</span>(amo_period)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#More groups for class names:</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>class_names_no_drop_frs <span class="ot">&lt;-</span> class_names[<span class="sc">!</span>class_names <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"drop"</span>, <span class="st">"frs"</span>)]</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>class_names_no_frs <span class="ot">&lt;-</span> class_names[<span class="sc">!</span>class_names <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"frs"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition, the file has the two functions shown below, the second of which has 6 functions nested within it:</p>
<p><img src="images/clipboard-227634940.png" class="img-fluid"></p>
</section>
<section id="outputs-from-get_funding_data" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="outputs-from-get_funding_data"><span class="header-section-number">2.4.2</span> Outputs from <code>get_funding_data()</code></h3>
<p>baseline_funding contains 9 data frames, one for each of the 7 classes, plus one for drop and one for frs as a whole. details below.</p>
<p>The 7 class dataframes contain 31 rows and 96 columns.</p>
<p>drop and frs contain 31 rows and 92 columns.</p>
<p>The 4 variables in regular but not in drop or frs are:</p>
<p>payroll_db_legacy_ratio, payroll_db_new_ratio, payroll_dc_legacy_ratio, payroll_dc_new_ratio</p>
<p>It seems like we should be able to stack these 9 data frames into a single data frame with a class column and work with them as a group? TBD.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>baseline_funding <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fs<span class="sc">::</span><span class="fu">path</span>(dfreason, <span class="st">"baseline_funding.rds"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"data frames in baseline_funding: "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data frames in baseline_funding: "</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(baseline_funding)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "regular"           "special"           "admin"            
[4] "eso"               "eco"               "judges"           
[7] "senior management" "drop"              "frs"              </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> column names in baseline_funding regular: "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "\n column names in baseline_funding regular: "</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(baseline_funding[[<span class="st">"regular"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "year"                          "total_payroll"                
 [3] "payroll_db_legacy"             "payroll_db_new"               
 [5] "payroll_dc_legacy"             "payroll_dc_new"               
 [7] "pvfb_retire_current"           "liability_gain_loss_legacy"   
 [9] "liability_gain_loss_new"       "total_liability_gain_loss"    
[11] "dr_legacy"                     "dr_new"                       
[13] "total_aal"                     "aal_legacy"                   
[15] "aal_new"                       "total_ava"                    
[17] "ava_legacy"                    "ava_new"                      
[19] "total_mva"                     "mva_legacy"                   
[21] "mva_new"                       "roa"                          
[23] "total_ual_ava"                 "ual_ava_legacy"               
[25] "ual_ava_new"                   "total_ual_mva"                
[27] "ual_mva_legacy"                "ual_mva_new"                  
[29] "fr_ava"                        "fr_mva"                       
[31] "total_nc_rate"                 "nc_rate_db_legacy"            
[33] "nc_rate_db_new"                "nc_rate_legacy"               
[35] "nc_rate_new"                   "ee_nc_rate_legacy"            
[37] "ee_nc_rate_new"                "er_nc_rate_legacy"            
[39] "er_nc_rate_new"                "er_stat_rate"                 
[41] "amo_rate_legacy"               "amo_rate_new"                 
[43] "admin_exp_rate"                "er_dc_rate_legacy"            
[45] "er_dc_rate_new"                "nc_legacy"                    
[47] "nc_new"                        "total_ee_nc_cont"             
[49] "ee_nc_cont_legacy"             "ee_nc_cont_new"               
[51] "total_er_nc_cont"              "er_nc_cont_legacy"            
[53] "er_nc_cont_new"                "total_er_amo_cont"            
[55] "er_amo_cont_legacy"            "er_amo_cont_new"              
[57] "er_dc_cont_legacy"             "er_dc_cont_new"               
[59] "total_er_cont"                 "total_er_db_cont"             
[61] "total_er_dc_cont"              "total_ben_payment"            
[63] "ben_payment_legacy"            "ben_payment_new"              
[65] "total_refund"                  "refund_legacy"                
[67] "refund_new"                    "disbursement_to_IP"           
[69] "admin_exp_legacy"              "admin_exp_new"                
[71] "total_solv_cont"               "solv_cont_legacy"             
[73] "solv_cont_new"                 "total_er_cont_rate"           
[75] "total_er_cont_real"            "cum_er_cont_real"             
[77] "total_ual_mva_real"            "all_in_cost_real"             
[79] "net_cf_legacy"                 "exp_inv_earnings_ava_legacy"  
[81] "alloc_inv_earnings_ava_legacy" "exp_ava_legacy"               
[83] "net_reallocation_legacy"       "ava_base_legacy"              
[85] "unadj_ava_legacy"              "net_cf_new"                   
[87] "exp_inv_earnings_ava_new"      "alloc_inv_earnings_ava_new"   
[89] "exp_ava_new"                   "net_reallocation_new"         
[91] "ava_base_new"                  "unadj_ava_new"                
[93] "payroll_db_legacy_ratio"       "payroll_db_new_ratio"         
[95] "payroll_dc_legacy_ratio"       "payroll_dc_new_ratio"         </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">glimpse of baseline_funding$regular"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "\nglimpse of baseline_funding$regular"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(baseline_funding<span class="sc">$</span>regular)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 31
Columns: 96
$ year                          &lt;dbl&gt; 2022, 2023, 2024, 2025, 2026, 2027, 2028…
$ total_payroll                 &lt;dbl&gt; 29126383663, 30072991132, 31050363344, 3…
$ payroll_db_legacy             &lt;dbl&gt; 18917045000, 20303453904, 20168543639, 1…
$ payroll_db_new                &lt;dbl&gt; 0, 0, 0, 428218925, 778925272, 121730268…
$ payroll_dc_legacy             &lt;dbl&gt; 10209338663, 9769537228, 10881819705, 10…
$ payroll_dc_new                &lt;dbl&gt; 0, 0, 0, 1284656776, 2336775817, 3651908…
$ pvfb_retire_current           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ liability_gain_loss_legacy    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ liability_gain_loss_new       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ total_liability_gain_loss     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ dr_legacy                     &lt;dbl&gt; 0.067, 0.000, 0.000, 0.000, 0.000, 0.000…
$ dr_new                        &lt;dbl&gt; 0.067, 0.000, 0.000, 0.000, 0.000, 0.000…
$ total_aal                     &lt;dbl&gt; 145585523000, 147921671633, 150221161154…
$ aal_legacy                    &lt;dbl&gt; 145585523000, 147921671633, 150221161154…
$ aal_new                       &lt;dbl&gt; 0, 0, 0, 32950899, 94920900, 194498302, …
$ total_ava                     &lt;dbl&gt; 123245363000, 125709632419, 128299290970…
$ ava_legacy                    &lt;dbl&gt; 123245363000, 125709632419, 128299290970…
$ ava_new                       &lt;dbl&gt; 0, 0, 0, 32964758, 94956895, 194565121, …
$ total_mva                     &lt;dbl&gt; 123965876000, 126286481055, 128749527907…
$ mva_legacy                    &lt;dbl&gt; 123965876000, 126286481055, 128749527907…
$ mva_new                       &lt;dbl&gt; 0, 0, 0, 32950899, 94919940, 194494754, …
$ roa                           &lt;dbl&gt; -0.0718, 0.0670, 0.0670, 0.0670, 0.0670,…
$ total_ual_ava                 &lt;dbl&gt; 22340160000, 22212039214, 21921870184, 2…
$ ual_ava_legacy                &lt;dbl&gt; 22340160000, 22212039214, 21921870184, 2…
$ ual_ava_new                   &lt;dbl&gt; 0.00, 0.00, 0.00, -13859.20, -35995.11, …
$ total_ual_mva                 &lt;dbl&gt; 21619647000, 21635190578, 21471633246, 2…
$ ual_mva_legacy                &lt;dbl&gt; 21619647000, 21635190578, 21471633246, 2…
$ ual_mva_new                   &lt;dbl&gt; 0.0000, 0.0000, 0.0000, 0.0000, 959.0904…
$ fr_ava                        &lt;dbl&gt; 0.8465496, 0.8498392, 0.8540694, 0.85845…
$ fr_mva                        &lt;dbl&gt; 0.8514986, 0.8537389, 0.8570665, 0.86064…
$ total_nc_rate                 &lt;dbl&gt; 0.08960000, 0.08960000, 0.08859359, 0.08…
$ nc_rate_db_legacy             &lt;dbl&gt; NA, 0.08960000, 0.08859359, 0.08841491, …
$ nc_rate_db_new                &lt;dbl&gt; NA, 0.00000000, 0.00000000, 0.08117562, …
$ nc_rate_legacy                &lt;dbl&gt; 0.08960000, 0.08960000, 0.08859359, 0.08…
$ nc_rate_new                   &lt;dbl&gt; 0.00000000, 0.00000000, 0.00000000, 0.08…
$ ee_nc_rate_legacy             &lt;dbl&gt; 0.03, 0.03, 0.03, 0.03, 0.03, 0.03, 0.03…
$ ee_nc_rate_new                &lt;dbl&gt; 0.00, 0.03, 0.03, 0.03, 0.03, 0.03, 0.03…
$ er_nc_rate_legacy             &lt;dbl&gt; 0.05960000, 0.05960000, 0.05859359, 0.05…
$ er_nc_rate_new                &lt;dbl&gt; 0.00000000, -0.03000000, -0.03000000, 0.…
$ er_stat_rate                  &lt;dbl&gt; 0.1223, 0.0000, 0.0000, 0.0000, 0.0000, …
$ amo_rate_legacy               &lt;dbl&gt; 0.06270000, 0.06832597, 0.07742988, 0.08…
$ amo_rate_new                  &lt;dbl&gt; 0.000000e+00, 0.000000e+00, 0.000000e+00…
$ admin_exp_rate                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ er_dc_rate_legacy             &lt;dbl&gt; 0.066, 0.066, 0.066, 0.066, 0.066, 0.066…
$ er_dc_rate_new                &lt;dbl&gt; 0.000, 0.066, 0.066, 0.066, 0.066, 0.066…
$ nc_legacy                     &lt;dbl&gt; 1694967232, 1819189376, 1786803756, 1762…
$ nc_new                        &lt;dbl&gt; 0, 0, 0, 34760939, 63288578, 99071021, 1…
$ total_ee_nc_cont              &lt;dbl&gt; 567511350, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ ee_nc_cont_legacy             &lt;dbl&gt; 567511350, 609103617, 605056309, 5978795…
$ ee_nc_cont_new                &lt;dbl&gt; 0, 0, 0, 12846568, 23367758, 36519080, 4…
$ total_er_nc_cont              &lt;dbl&gt; 1127455882, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ er_nc_cont_legacy             &lt;dbl&gt; 1127455882, 1210085759, 1181747446, 1164…
$ er_nc_cont_new                &lt;dbl&gt; 0, 0, 0, 21914371, 39920820, 62551941, 8…
$ total_er_amo_cont             &lt;dbl&gt; 1285098768, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ er_amo_cont_legacy            &lt;dbl&gt; 1285098768, 1387253178, 1561647991, 1601…
$ er_amo_cont_new               &lt;dbl&gt; 0.0000, 0.0000, 0.0000, 0.0000, -928.490…
$ er_dc_cont_legacy             &lt;dbl&gt; 673816352, 644789457, 718200101, 6875422…
$ er_dc_cont_new                &lt;dbl&gt; 0, 0, 0, 84787347, 154227204, 241025931,…
$ total_er_cont                 &lt;dbl&gt; 3086371002, 3242128394, 3461595538, 3559…
$ total_er_db_cont              &lt;dbl&gt; 2412554650, 2597338937, 2743395438, 2787…
$ total_er_dc_cont              &lt;dbl&gt; 673816352, 644789457, 718200101, 7723296…
$ total_ben_payment             &lt;dbl&gt; 8373165621, 8990697601, 9141605583, 9291…
$ ben_payment_legacy            &lt;dbl&gt; 8373165621, 8990697601, 9141605583, 9291…
$ ben_payment_new               &lt;dbl&gt; 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, …
$ total_refund                  &lt;dbl&gt; 19868333, 9896207, 13620152, 16118442, 1…
$ refund_legacy                 &lt;dbl&gt; 19868333, 9896207, 13620152, 13257090, 1…
$ refund_new                    &lt;dbl&gt; 0, 0, 0, 2861352, 5433028, 8827469, 1224…
$ disbursement_to_IP            &lt;dbl&gt; 538425529, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ admin_exp_legacy              &lt;dbl&gt; 15768185, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ admin_exp_new                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ total_solv_cont               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ solv_cont_legacy              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ solv_cont_new                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ total_er_cont_rate            &lt;dbl&gt; 0.10596479, 0.10780864, 0.11148325, 0.11…
$ total_er_cont_real            &lt;dbl&gt; 3086371002, 3166141010, 3301234759, 3315…
$ cum_er_cont_real              &lt;dbl&gt; 0, 3166141010, 6467375769, 9782644966, 1…
$ total_ual_mva_real            &lt;dbl&gt; 21619647000, 21128115799, 20476945158, 1…
$ all_in_cost_real              &lt;dbl&gt; 0, 24294256809, 26944320927, 29578956600…
$ net_cf_legacy                 &lt;dbl&gt; -5967161667, -5794151254, -5806773988, -…
$ exp_inv_earnings_ava_legacy   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ alloc_inv_earnings_ava_legacy &lt;dbl&gt; 8163242000, 8217074502, 8358849778, 8508…
$ exp_ava_legacy                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ net_reallocation_legacy       &lt;dbl&gt; 670660000, 41346171, 37582761, 38275319,…
$ ava_base_legacy               &lt;dbl&gt; 0, 120348287373, 122806245425, 125328490…
$ unadj_ava_legacy              &lt;dbl&gt; 0, 125668286248, 128261708209, 130866076…
$ net_cf_new                    &lt;dbl&gt; 0, 0, 0, 31899587, 57854621, 90241109, 1…
$ exp_inv_earnings_ava_new      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ alloc_inv_earnings_ava_new    &lt;dbl&gt; 0, 0, 0, 1065171, 4137517, 9367217, 1700…
$ exp_ava_new                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ net_reallocation_new          &lt;dbl&gt; 0.000000e+00, 0.000000e+00, 0.000000e+00…
$ ava_base_new                  &lt;dbl&gt; 0, 0, 0, 15949793, 61892069, 140077449, …
$ unadj_ava_new                 &lt;dbl&gt; 0, 0, 0, 32964758, 94956896, 194565220, …
$ payroll_db_legacy_ratio       &lt;dbl&gt; NA, 0.6751392, 0.6495429, 0.6216353, 0.5…
$ payroll_db_new_ratio          &lt;dbl&gt; NA, 0.00000000, 0.00000000, 0.01335701, …
$ payroll_dc_legacy_ratio       &lt;dbl&gt; NA, 0.32486084, 0.35045708, 0.32493666, …
$ payroll_dc_new_ratio          &lt;dbl&gt; NA, 0.00000000, 0.00000000, 0.04007102, …</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">dimensions and variables for the 9 data frames:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "\ndimensions and variables for the 9 data frames:"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(name <span class="cf">in</span> <span class="fu">names</span>(baseline_funding)){</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(name, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"rows, cols: "</span>, <span class="fu">dim</span>(baseline_funding[[name]]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  diffs <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(baseline_funding[[<span class="st">"regular"</span>]]),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">names</span>(baseline_funding[[name]]))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"variables in regular but not in"</span>, name, <span class="st">":</span><span class="sc">\n</span><span class="st">  "</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(diffs, <span class="at">sep=</span><span class="st">", "</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
regular 
rows, cols:  31 96 
variables in regular but not in regular :
  

special 
rows, cols:  31 96 
variables in regular but not in special :
  

admin 
rows, cols:  31 96 
variables in regular but not in admin :
  

eso 
rows, cols:  31 96 
variables in regular but not in eso :
  

eco 
rows, cols:  31 96 
variables in regular but not in eco :
  

judges 
rows, cols:  31 96 
variables in regular but not in judges :
  

senior management 
rows, cols:  31 96 
variables in regular but not in senior management :
  

drop 
rows, cols:  31 92 
variables in regular but not in drop :
  payroll_db_legacy_ratio, payroll_db_new_ratio, payroll_dc_legacy_ratio, payroll_dc_new_ratio

frs 
rows, cols:  31 92 
variables in regular but not in frs :
  payroll_db_legacy_ratio, payroll_db_new_ratio, payroll_dc_legacy_ratio, payroll_dc_new_ratio</code></pre>
</div>
</div>
</section>
<section id="inputs-to-get_funding_data" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="inputs-to-get_funding_data"><span class="header-section-number">2.4.3</span> Inputs to get_funding_data()</h3>
</section>
<section id="reproducing-results" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="reproducing-results"><span class="header-section-number">2.4.4</span> Reproducing results</h3>
<p>The following steps reproduce the results.</p>
</section>
</section>
<section id="reproduce-baseline_liability---get_liability_data-with-more-generalizable-code" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="reproduce-baseline_liability---get_liability_data-with-more-generalizable-code"><span class="header-section-number">2.5</span> Reproduce <code>baseline_liability &lt;- get_liability_data()</code> with more generalizable code</h2>
<section id="introduction-1" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="introduction-1"><span class="header-section-number">2.5.1</span> Introduction</h3>
</section>
<section id="outputs-from-get_liability_data" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="outputs-from-get_liability_data"><span class="header-section-number">2.5.2</span> Outputs from <code>get_liability_data()</code></h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>baseline_liability <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fs<span class="sc">::</span><span class="fu">path</span>(dfreason, <span class="st">"baseline_liability.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="inputs-to-get_liability_data" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="inputs-to-get_liability_data"><span class="header-section-number">2.5.3</span> Inputs to get_liability_data()</h3>
</section>
<section id="reproducing-results-1" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="reproducing-results-1"><span class="header-section-number">2.5.4</span> Reproducing results</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>